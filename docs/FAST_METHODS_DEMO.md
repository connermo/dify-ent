# ğŸš€ Dify ä¾¿æ·æ„å»ºæ–¹æ³•æ¼”ç¤º

ä½ é—®å¾—å¾ˆå¯¹ï¼ç¡®å®æœ‰æ›´ä¾¿æ·çš„æ–¹æ³•ã€‚æˆ‘ä¸ºä½ åˆ›å»ºäº†å‡ ç§è¶…å¿«é€Ÿçš„æ„å»ºå’Œæ›´æ–°æ–¹æ¡ˆï¼š

## âš¡ æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | æ—¶é—´ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ |
|------|------|---------|------|
| ğŸ”¥ **çƒ­ä¿®å¤è¿è¡Œå®¹å™¨** | ~10ç§’ | å¼€å‘è°ƒè¯• | æœ€å¿«é€Ÿåº¦ï¼Œç›´æ¥ä¿®æ”¹è¿è¡Œä¸­å®¹å™¨ |
| ğŸ¯ **è¡¥ä¸å®˜æ–¹é•œåƒ** | ~2-5åˆ†é’Ÿ | é¦–æ¬¡è®¾ç½®/æ›´æ–° | åŸºäºå®˜æ–¹é•œåƒï¼Œé¿å…å®Œæ•´æ„å»º |
| ğŸ—ï¸ **å®Œæ•´é‡æ–°æ„å»º** | ~10-20åˆ†é’Ÿ | ç”Ÿäº§ç¯å¢ƒ | æœ€å½»åº•ï¼Œä»æºç å¼€å§‹æ„å»º |

## ğŸ”¥ æ–¹æ³• 1: çƒ­ä¿®å¤è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆæ¨èå¼€å‘ä½¿ç”¨ï¼‰

æœ€å¿«çš„æ–¹æ³•ï¼ç›´æ¥å¯¹è¿è¡Œä¸­çš„å®¹å™¨åº”ç”¨è¡¥ä¸ï¼š

```bash
# 1. å¯åŠ¨å®˜æ–¹å®¹å™¨ï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰
docker run -d --name dify-api langgenius/dify-api:latest

# 2. çƒ­ä¿®å¤åº”ç”¨è¡¥ä¸ï¼ˆ10ç§’å†…å®Œæˆï¼‰
./scripts/hotfix-running-container.sh --commit --restart

# å®Œæˆï¼ä½ çš„å®¹å™¨ç°åœ¨å°±æœ‰ SSO åŠŸèƒ½äº†
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… å¿«é€Ÿæµ‹è¯•ä»£ç ä¿®æ”¹
- âœ… å¼€å‘é˜¶æ®µè°ƒè¯•
- âœ… ç´§æ€¥ä¿®å¤
- âœ… å­¦ä¹ å’Œå®éªŒ

## ğŸ¯ æ–¹æ³• 2: è¡¥ä¸å®˜æ–¹é•œåƒï¼ˆæ¨èé¦–æ¬¡è®¾ç½®ï¼‰

åŸºäºå®˜æ–¹é•œåƒå¿«é€Ÿåˆ›å»ºå¸¦è¡¥ä¸çš„ç‰ˆæœ¬ï¼š

```bash
# 1. ç›´æ¥å¯¹å®˜æ–¹é•œåƒåº”ç”¨è¡¥ä¸
./scripts/patch-and-commit.sh --pull

# 2. ä½¿ç”¨ç”Ÿæˆçš„é•œåƒå¯åŠ¨
docker-compose -f docker-compose.local-images.yml up -d
```

**å·¥ä½œåŸç†ï¼š**
1. ä¸‹è½½å®˜æ–¹é•œåƒ `langgenius/dify-api:latest`
2. åˆ›å»ºä¸´æ—¶å®¹å™¨
3. å¤åˆ¶è¡¥ä¸æ–‡ä»¶åˆ°å®¹å™¨ä¸­
4. æäº¤ä¸ºæ–°é•œåƒ `dify-local/dify-api:latest`

**ä¼˜ç‚¹ï¼š**
- âœ… å‡ åˆ†é’Ÿå†…å®Œæˆ
- âœ… åŸºäºæœ€æ–°å®˜æ–¹é•œåƒ
- âœ… é•œåƒä½“ç§¯å°
- âœ… æ”¯æŒç‰ˆæœ¬ç®¡ç†

## ğŸ› ï¸ å®é™…æ¼”ç¤º

### æ¼”ç¤ºåœºæ™¯ï¼šä¿®æ”¹ API ä»£ç åå¿«é€Ÿåº”ç”¨

```bash
# 1. ä¿®æ”¹æºç 
echo "# æˆ‘çš„ä¿®æ”¹" >> dify/api/controllers/console/auth/oauth.py

# 2. çƒ­ä¿®å¤åˆ°è¿è¡Œä¸­çš„å®¹å™¨ï¼ˆæœ€å¿«ï¼‰
./scripts/hotfix-running-container.sh api

# æˆ–è€…æäº¤ä¸ºæ–°é•œåƒ
./scripts/hotfix-running-container.sh api --commit

# 3. éªŒè¯ä¿®æ”¹ç”Ÿæ•ˆ
curl http://localhost:5001/console/api/oauth/providers
```

### ä½¿ç”¨ Makefile å¿«æ·å‘½ä»¤

```bash
cd dify

# å¿«é€Ÿå¼€å‘ç¯å¢ƒæ­å»º
make dev-quick-start

# å¼€å‘è¿‡ç¨‹ä¸­çš„å¿«é€Ÿä¿®å¤
make dev-hotfix

# åªçƒ­ä¿®å¤è¿è¡Œä¸­å®¹å™¨
make hotfix-running

# è¡¥ä¸å®˜æ–¹é•œåƒ
make patch-official-images
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”æµ‹è¯•

### ä¼ ç»Ÿå®Œæ•´æ„å»ºæ–¹æ³•
```bash
time ./scripts/build-local-images.sh
# è¾“å‡º: ~15-25åˆ†é’Ÿ
```

### ğŸ”¥ è¡¥ä¸ç°æœ‰é•œåƒæ–¹æ³•
```bash
time ./scripts/patch-and-commit.sh
# è¾“å‡º: ~2-5åˆ†é’Ÿï¼ˆä¸‹è½½æ—¶é—´å–å†³äºç½‘ç»œï¼‰
```

### âš¡ çƒ­ä¿®å¤è¿è¡Œå®¹å™¨æ–¹æ³•
```bash
time ./scripts/hotfix-running-container.sh
# è¾“å‡º: ~5-15ç§’
```

## ğŸ¯ æ¨èå·¥ä½œæµ

### é¦–æ¬¡è®¾ç½®
```bash
# 1. å¿«é€Ÿè·å–å¸¦è¡¥ä¸çš„é•œåƒ
./scripts/patch-and-commit.sh --pull

# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.local-images.yml up -d
```

### æ—¥å¸¸å¼€å‘
```bash
# ä¿®æ”¹ä»£ç å...
./scripts/hotfix-running-container.sh --commit
```

### å‡†å¤‡å‘å¸ƒ
```bash
# å®Œæ•´é‡æ–°æ„å»ºç¡®ä¿è´¨é‡
./scripts/build-local-images.sh
```

## ğŸ” æŠ€æœ¯ç»†èŠ‚

### çƒ­ä¿®å¤åŸç†
1. æ£€æµ‹è¿è¡Œä¸­çš„å®¹å™¨
2. ä½¿ç”¨ `docker cp` å¤åˆ¶ä¿®æ”¹åçš„æ–‡ä»¶
3. å‘é€ä¿¡å·é‡å¯åº”ç”¨è¿›ç¨‹
4. å¯é€‰ï¼šæäº¤ä¸ºæ–°é•œåƒ

### è¡¥ä¸é•œåƒåŸç†
1. ä½¿ç”¨ `docker create` åˆ›å»ºä¸´æ—¶å®¹å™¨
2. å¤åˆ¶è¡¥ä¸æ–‡ä»¶åˆ°å®¹å™¨
3. ä½¿ç”¨ `docker commit` ä¿å­˜ä¸ºæ–°é•œåƒ
4. æ¸…ç†ä¸´æ—¶å®¹å™¨

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **çƒ­ä¿®å¤ä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒ**
   - å®¹å™¨é‡å¯åä¿®æ”¹ä¼šä¸¢å¤±ï¼ˆé™¤éä½¿ç”¨ --commitï¼‰
   - é€‚åˆå¿«é€Ÿæµ‹è¯•ï¼Œä¸é€‚åˆç”Ÿäº§

2. **è¡¥ä¸é•œåƒçš„é™åˆ¶**
   - éœ€è¦ç¡®ä¿è¡¥ä¸æ–‡ä»¶è·¯å¾„æ­£ç¡®
   - æŸäº›æ·±å±‚ä¾èµ–ä¿®æ”¹å¯èƒ½éœ€è¦å®Œæ•´é‡æ„å»º

3. **ç‰ˆæœ¬ä¸€è‡´æ€§**
   - å»ºè®®å®šæœŸåŒæ­¥å®˜æ–¹é•œåƒç‰ˆæœ¬
   - ä½¿ç”¨ç‰ˆæœ¬æ ‡ç­¾ç®¡ç†ä¸åŒçš„è¡¥ä¸ç‰ˆæœ¬

## ğŸ‰ æ€»ç»“

ç°åœ¨ä½ æœ‰äº†ä¸‰ç§æ–¹æ³•ï¼š

1. **ğŸ”¥ çƒ­ä¿®å¤** - æœ€å¿«ï¼ˆç§’çº§ï¼‰ï¼Œé€‚åˆå¼€å‘è°ƒè¯•
2. **ğŸ¯ è¡¥ä¸é•œåƒ** - å¿«é€Ÿï¼ˆåˆ†é’Ÿçº§ï¼‰ï¼Œé€‚åˆæ—¥å¸¸ä½¿ç”¨  
3. **ğŸ—ï¸ å®Œæ•´æ„å»º** - å½»åº•ï¼ˆååˆ†é’Ÿçº§ï¼‰ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒ

é€‰æ‹©æœ€é€‚åˆä½ å½“å‰éœ€æ±‚çš„æ–¹æ³•å³å¯ï¼

---

**å¿«é€Ÿå¼€å§‹ï¼š**
```bash
# æœ€å¿«ä¸Šæ‰‹æ–¹å¼
./scripts/patch-and-commit.sh --pull
docker-compose -f docker-compose.local-images.yml up -d
```

